(function(q){var r={undHash:/_|-/,colons:/::/,words:/([A-Z]+)([A-Z][a-z])/g,lowerUpper:/([a-z\d])([A-Z])/g,dash:/([a-z\d])([A-Z])/g,replacer:/\{([^\}]+)\}/g,dot:/\./},y=function(d,h,o){return d[h]||o&&(d[h]={})},z=function(d){return(d=typeof d)&&(d=="function"||d=="object")},w=function(d,h,o){d=d?d.split(r.dot):[];var e=d.length;h=q.isArray(h)?h:[h||window];var i,k,g,t=0;if(e==0)return h[0];for(;i=h[t++];){for(g=0;g<e-1&&z(i);g++)i=y(i,d[g],o);if(z(i)){k=y(i,d[g],o);if(k!==undefined){o===false&&delete i[d[g]];
return k}}}},u=q.String={getObject:w,strip:function(d){return d.replace(/^\s+/,"").replace(/\s+$/,"")},capitalize:function(d){return d.charAt(0).toUpperCase()+d.substr(1)},endsWith:function(d,h){var o=d.length-h.length;return o>=0&&d.lastIndexOf(h)===o},camelize:function(d){d=d.split(r.undHash);var h=1;for(d[0]=d[0].charAt(0).toLowerCase()+d[0].substr(1);h<d.length;h++)d[h]=u.capitalize(d[h]);return d.join("")},classize:function(d){d=d.split(r.undHash);for(var h=0;h<d.length;h++)d[h]=u.capitalize(d[h]);
return d.join("")},niceName:function(d){d=d.split(r.undHash);for(var h=0;h<d.length;h++)d[h]=u.capitalize(d[h]);return d.join(" ")},underscore:function(d){return d.replace(r.colons,"/").replace(r.words,"$1_$2").replace(r.lowerUpper,"$1_$2").replace(r.dash,"_").toLowerCase()},sub:function(d,h,o){var e=[];e.push(d.replace(r.replacer,function(i,k){i=w(k,h,!o);k=typeof i;if((k==="object"||k==="function")&&k!==null){e.push(i);return""}else return""+i}));return e.length<=1?e[0]:e}}})(jQuery);
(function(q){var r=false,y=q.makeArray,z=q.isFunction,w=q.isArray,u=function(e,i){return e.concat(y(i))},d=/xyz/.test(function(){})?/\b_super\b/:/.*/,h=function(e,i,k){k=k||e;for(var g in e)k[g]=z(e[g])&&z(i[g])&&d.test(e[g])?function(t,v){return function(){var p=this._super,s;this._super=i[t];s=v.apply(this,arguments);this._super=p;return s}}(g,e[g]):e[g]},o=q.Class=function(){arguments.length&&o.extend.apply(o,arguments)};q.extend(o,{callback:function(e){var i=y(arguments),k;e=i.shift();w(e)||(e=
[e]);k=this;return function(){for(var g=u(i,arguments),t,v=e.length,p=0,s;p<v;p++)if(s=e[p]){if((t=typeof s=="string")&&k._set_called)k.called=s;g=(t?k[s]:s).apply(k,g||[]);if(p<v-1)g=!w(g)||g._use_call?[g]:g}return g}},getObject:q.String.getObject,newInstance:function(){var e=this.rawInstance(),i;if(e.setup)i=e.setup.apply(e,arguments);if(e.init)e.init.apply(e,w(i)?i:arguments);return e},setup:function(e){this.defaults=q.extend(true,{},e.defaults,this.defaults);return arguments},rawInstance:function(){r=
true;var e=new this;r=false;return e},extend:function(e,i,k){function g(){if(!r)return this.constructor!==g&&arguments.length?arguments.callee.extend.apply(arguments.callee,arguments):this.Class.newInstance.apply(this.Class,arguments)}if(typeof e!="string"){k=i;i=e;e=null}if(!k){k=i;i=null}k=k||{};var t=this,v=this.prototype,p,s,a,b;r=true;b=new this;r=false;h(k,v,b);for(p in this)if(this.hasOwnProperty(p)&&q.inArray(p,["prototype","defaults","getObject"])==-1)g[p]=this[p];h(i,this,g);if(e){a=e.split(/\./);
s=a.pop();a=v=o.getObject(a.join("."),window,true);v[s]=g}q.extend(g,{prototype:b,namespace:a,shortName:s,constructor:g,fullName:e});g.prototype.Class=g.prototype.constructor=g;t=g.setup.apply(g,u([t],arguments));if(g.init)g.init.apply(g,t||[]);return g}});o.prototype.callback=o.callback})(jQuery);
(function(){var q=$.String.underscore,r=$.String.classize,y=$.isArray,z=$.makeArray,w=$.extend,u=$.each,d=/GET|POST|PUT|DELETE/i,h=function(a,b,c,j,l,f,m){m=m||"json";var n="";if(typeof a=="string"){var x=a.indexOf(" ");if(x>2&&x<7){n=a.substr(0,x);if(d.test(n))f=n;else m=n;n=a.substr(x+1)}else n=a}b=w({},b);a=$.String.sub(n,b,true);return $.ajax({url:a,data:b,success:c,error:j,type:f||"post",dataType:m,fixture:l})},o=function(a,b){var c=q(this.shortName),j="-"+c+(a||"");return $.fixture&&$.fixture[j]?
j:b||"//"+q(this.fullName).replace(/\.models\..*/,"").replace(/\./g,"/")+"/fixtures/"+c+(a||"")+".json"},e=function(a,b){a=a||{};var c=this.id;if(a[c]&&a[c]!==b){a["new"+$.String.capitalize(b)]=a[c];delete a[c]}a[c]=b;return a},i=function(a){return new (a||$.Model.List||Array)},k=function(a){return a[a.Class.id]},g=function(a){for(var b=[],c=0;c<a.length;c++)if(!a[c]["__u Nique"]){b.push(a[c]);a[c]["__u Nique"]=true}for(c=0;c<b.length;c++)delete b[c]["__u Nique"];return b},t=function(a,b,c,j,l){var f=
$.Deferred(),m=[a.attrs(),function(n){a[l||b+"d"](n);f.resolveWith(a,[a,n,b])},function(n){f.rejectWith(a,[n])}];b=="destroy"&&m.shift();b!=="create"&&m.unshift(k(a));f.then(c);f.fail(j);a.Class[b].apply(a.Class,m);return f.promise()},v=function(a){return typeof a==="object"&&a!==null&&a},p=function(a){return function(){$.fn[a].apply($([this]),arguments);return this}},s=p("bind");p=p("unbind");ajaxMethods={create:function(a){return function(b,c,j){return h(a,b,c,j,"-restCreate")}},update:function(a){return function(b,
c,j,l){return h(a,e.call(this,c,b),j,l,"-restUpdate","put")}},destroy:function(a){return function(b,c,j){var l={};l[this.id]=b;return h(a,l,c,j,"-restDestroy","delete")}},findAll:function(a){return function(b,c,j){return h(a||this.shortName+"s.json",b,c,j,o.call(this,"s"),"get","json "+this._shortName+".models")}},findOne:function(a){return function(b,c,j){return h(a,b,c,j,o.call(this),"get","json "+this._shortName+".model")}}};jQuery.Class("jQuery.Model",{setup:function(a){var b=this;u(["attributes",
"associations","validations"],function(l,f){if(!b[f]||a[f]===b[f])b[f]={}});if(a.convert!=this.convert)this.convert=w(a.convert,this.convert);this._fullName=q(this.fullName.replace(/\./g,"_"));this._shortName=q(this.shortName);if(this.fullName.substr(0,7)!="jQuery."){if(this.listType)this.list=new this.listType([]);for(var c in ajaxMethods)if(typeof this[c]!=="function")this[c]=ajaxMethods[c](this[c]);c={};var j="* "+this._shortName+".model";c[j+"s"]=this.callback("models");c[j]=this.callback("model");
$.ajaxSetup({converters:c})}},attributes:{},model:function(a){if(!a)return null;return new this(v(a[this.singularName])||v(a.data)||v(a.attributes)||a)},models:function(a){if(!a)return null;var b=i(this.List),c=y(a),j=c?a:a.data,l=j.length,f=0;for(b._use_call=true;f<l;f++)b.push(this.model(j[f]));if(!c)for(var m in a)if(m!=="data")b[m]=a[m];return b},id:"id",addAttr:function(a,b){if(!this.associations[a]){this.attributes[a]||(this.attributes[a]=b);return b}},_models:{},publish:function(a,b){window.OpenAjax&&
OpenAjax.hub.publish(this._shortName+"."+a,b)},guessType:function(){return"string"},convert:{date:function(a){return typeof a==="string"?isNaN(Date.parse(a))?null:Date.parse(a):a},number:function(a){return parseFloat(a)},"boolean":function(a){return Boolean(a)}},bind:s,unbind:p},{setup:function(a){this._init=true;this.attrs(w({},this.Class.defaults,a));delete this._init},update:function(a,b,c){this.attrs(a);return this.save(b,c)},errors:function(a){if(a)a=y(a)?a:z(arguments);var b={},c=this,j=function(f,
m){u(m,function(n,x){if(n=x.call(c)){b.hasOwnProperty(f)||(b[f]=[]);b[f].push(n)}})};u(a||this.Class.validations||{},function(f,m){if(typeof f=="number"){f=m;m=c.Class.validations[f]}j(f,m||[])});for(var l in b)if(b.hasOwnProperty(l))return b;return null},attr:function(a,b,c,j){var l=r(a),f="get"+l;if(b!==undefined){this._setProperty(a,b,c,j,l);return this}return this[f]?this[f]():this[a]},bind:s,unbind:p,_setProperty:function(a,b,c,j,l){l="set"+l;var f=this[a],m=this,n=function(x){j&&j.call(m,x);
$(m).triggerHandler("error."+a,x)};this[l]&&(b=this[l](b,this.callback("_updateProperty",a,b,f,c,n),n))===undefined||this._updateProperty(a,b,f,c,n)},_updateProperty:function(a,b,c,j,l){var f=this.Class,m=f.attributes[a]||f.addAttr(a,f.guessType(b)),n=f.convert[m];m=null;b=this[a]=b===null?null:n?n.call(f,b):b;this._init||(m=this.errors(a));if(m)l(m);else{if(c!==b&&!this._init){$(this).triggerHandler(a,[b]);$(this).triggerHandler("updated.attr",[a,b,c])}j&&j(this)}if(a==f.id&&b!==null&&f.list)if(c){if(c!=
b){f.list.remove(c);f.list.push(this)}}else f.list.push(this)},attrs:function(a){var b;if(a){var c=this.Class.id;for(b in a)b!=c&&this.attr(b,a[b]);c in a&&this.attr(c,a[c])}else{a={};for(b in this.Class.attributes)if(this.Class.attributes.hasOwnProperty(b))a[b]=this.attr(b)}return a},isNew:function(){var a=k(this);return a===undefined||a===null},save:function(a,b){return t(this,this.isNew()?"create":"update",a,b)},destroy:function(a,b){return t(this,"destroy",a,b,"destroyed")},identity:function(){var a=
k(this);return this.Class._fullName+"_"+(this.Class.escapeIdentity?encodeURIComponent(a):a)},elements:function(a){return $("."+this.identity(),a)},publish:function(a,b){this.Class.publish(a,b||this)},hookup:function(a){var b=this.Class._shortName,c=$.data(a,"models")||$.data(a,"models",{});$(a).addClass(b+" "+this.identity());c[b]=this}});$.Model.wrapMany=$.Model.models;$.Model.wrap=$.Model.model;u(["created","updated","destroyed"],function(a,b){$.Model.prototype[b]=function(c){b==="destroyed"&&this.Class.list&&
this.Class.list.remove(k(this));c&&typeof c=="object"&&this.attrs(c.attrs?c.attrs():c);$(this).triggerHandler(b);this.publish(b,this);$([this.Class]).triggerHandler(b,this);return[this].concat(z(arguments))}});$.fn.models=function(){var a=[],b,c;this.each(function(){u($.data(this,"models")||{},function(j,l){b=b===undefined?l.Class.List||null:l.Class.List===b?b:null;a.push(l)})});c=i(b);c.push.apply(c,g(a));return c};$.fn.model=function(a){if(a&&a instanceof $.Model){a.hookup(this[0]);return this}else return this.models.apply(this,
arguments)[0]}})(jQuery);
